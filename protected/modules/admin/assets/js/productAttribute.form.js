// Generated by CoffeeScript 1.6.3
(function() {
  var __hasProp = {}.hasOwnProperty;

  $(function() {
    var add_variant_button, check_field_type, checkbox_variants_rows, field_type_input, update_variants, variant_values, variants_block, variants_input, variants_rows;
    field_type_input = $('#ProductAttribute_field_type');
    variants_block = $('#variants');
    variants_input = $('#ProductAttribute_variants');
    variants_rows = $('.variant_rows', variants_block);
    checkbox_variants_rows = $('.checkbox_variants', variants_block);
    add_variant_button = $('.add_variant', variants_block);
    variant_values = {};
    update_variants = function() {
      var block, counter, default_input, default_val, i, input, inputs, value, _i, _len;
      if (field_type_input.val() === 'checkbox') {
        block = checkbox_variants_rows;
      } else {
        block = variants_rows;
      }
      inputs = $('.control-row input', block);
      variant_values = {};
      counter = 0;
      for (_i = 0, _len = inputs.length; _i < _len; _i++) {
        input = inputs[_i];
        input = $(input);
        if (input.val() === '') {
          continue;
        }
        variant_values[counter++] = input.val();
      }
      default_input = $('#ProductAttribute_default');
      default_val = default_input.val() || 0;
      if (default_input.is('select')) {
        if (field_type_input.val() === 'checkbox') {
          $('option', default_input).remove();
        } else {
          $('option', default_input).remove();
          default_input.append("<option value=''></option>");
        }
        for (i in variant_values) {
          if (!__hasProp.call(variant_values, i)) continue;
          value = variant_values[i];
          default_input.append("<option value='" + i + "'>" + value + "</option>");
        }
        return default_input.val(default_val);
      }
    };
    update_variants();
    check_field_type = function(e) {
      var default_input;
      default_input = $('#ProductAttribute_default');
      if (field_type_input.val() === 'string' || field_type_input.val() === 'text') {
        if (default_input.is('select')) {
          default_input.replaceWith('<input class="span8" type="text" id="ProductAttribute_default" name="ProductAttribute[default]" />');
        }
        return variants_block.hide();
      } else {
        if (default_input.is('input')) {
          default_input.replaceWith('<select class="span8" type="text" id="ProductAttribute_default" name="ProductAttribute[default]" />');
        }
        if (field_type_input.val() === 'checkbox') {
          checkbox_variants_rows.show();
          variants_rows.hide();
          add_variant_button.hide();
        } else {
          checkbox_variants_rows.hide();
          variants_rows.show();
          add_variant_button.show();
        }
        update_variants();
        return variants_block.show();
      }
    };
    check_field_type();
    field_type_input.change(check_field_type);
    add_variant_button.click(function(e) {
      variants_rows.append('<div class="control-row"><input type="text" /></div>').focus();
      $('.control-row', variants_rows).last().find('input').focus();
      return false;
    });
    return variants_block.add(checkbox_variants_rows).on('keyup', '.control-row input', function(e) {
      update_variants();
      return variants_input.val(JSON.stringify(variant_values));
    });
  });

}).call(this);

/*
//@ sourceMappingURL=productAttribute.form.map
*/
